# 【要件定義書】中トロドン Webアプリケーション
# 1. 改訂履歴
| **版数** | **改訂日** | **改訂内容** | **作成者** |
|:-:|:-:|:-:|:-:|
| 1.1 | 2025/07/14 | 楽曲再生ロジック変更（durationを任意項目化） | Gemini |
| 1.0 | 2025/07/14 | 初版作成 | Gemini |
# 2. はじめに
### 2.1. 本書の目的
本書は、Webアプリケーション「中トロドン」の開発にあたり、その仕様、機能、および非機能要件を明確に定義することを目的とします。本書は、開発チーム、デザイナー、およびプロジェクト関係者間の共通認識を形成するための基礎資料となります。
### 2.2. プロダクト概要
「中トロドン」は、楽曲の中盤（サビやBメロなど）を聴いて曲名を当てる、新感覚の音楽クイズWebアプリケーションです。ユーザーは出題範囲を好きなアーティストのアルバム単位でカスタマイズでき、より深く音楽を楽しむ体験を提供します。
### 2.3. 開発の背景と目的
従来のイントロクイズとは一線を画し、楽曲の最も特徴的な部分から出題することで、アーティストのファンはより深く知識を試し、ライトな音楽ファンは新たな曲と出会うきっかけを得ることができます。友人や家族と手軽に楽しめるエンターテイメントを提供し、音楽を通じたコミュニケーションの活性化を目指します。
# 3. システム構成
### 3.1. 技術スタック
本アプリケーションは、以下の技術スタックで開発を行います。
| **カテゴリ** | **技術** | **バージョン/備考** |
|:-:|:-:|:-:|
| フレームワーク | Next.js | v15以降 (App Router) |
| 言語 | TypeScript | - |
| スタイリング | Tailwind CSS | - |
| テスティング | Jest | - |
| Linter/Formatter | Biome | - |
| パッケージ管理 | pnpm | - |
### 3.2. データ管理
* **楽曲データ:** アプリケーション内で使用する楽曲情報は、静的なJSONファイルで管理します。
* **データ構造:** 楽曲データは、アーティスト、アルバム、楽曲の階層構造で定義します。

⠀songs.json **の構造例:**
### {
###   "artists": [
###     {
###       "id": "artist001",
###       "name": "アーティストA",
###       "albums": [
###         {
###           "id": "album001",
###           "name": "アルバムX",
###           "jacketUrl": "https://example.com/jacketX.jpg",
###           "tracks": [
###             {
###               "id": "track001",
###               "title": "曲1",
###               "youtubeUrl": "https://www.youtube.com/watch?v=xxxxxx"
###             },
###             {
###               "id": "track002",
###               "title": "短い曲2",
###               "youtubeUrl": "https://www.youtube.com/watch?v=yyyyyy",
###               "duration": 120,
###               "midpointStart": 55
###             }
###           ]
###         }
###       ]
###     }
###   ]
### }
* duration **(任意):** 曲の総再生時間（秒）。短い曲や特に長い曲など、再生開始位置の計算で標準と異なる考慮が必要な場合に**任意で設定**します。
* midpointStart **(任意):** 中盤再生の推奨開始時間（秒）。計算ロジックよりも優先して再生開始位置を固定したい場合に利用します。

⠀4. 機能要件
### 4.1. 画面一覧・遷移図
### graph TD
###     A[トップ画面] -->|「クイズ開始」クリック| B(クイズ画面);
###     B -->|「設定変更」クリック| C{出題範囲設定モーダル};
###     C -->|「設定を閉じる」クリック| B;
###     B -->|「次へ」クリック| B;
###     B -->|全問終了後「トップへ戻る」クリック| A;
### 4.2. 画面別要件定義
**4.2.1. トップ画面 (** / **)**
ユーザーが最初に訪れる画面。クイズの開始と、初期の出題範囲設定を行います。
**UIコンポーネントと仕様:**
| **No.** | **UI要素** | **種別** | **説明** |
|:-:|:-:|:-:|:-:|
| 1 | アプリケーションロゴ | 画像/テキスト | 「中トロドン」のタイトルロゴを表示する。 |
| 2 | 出題範囲設定エリア | コンテナ | アーティストとアルバムを選択するエリア。 |
| 3 | アーティスト選択 | プルダウン | songs.json からアーティスト一覧を動的に生成し、表示する。 |
| 4 | アルバム選択リスト | チェックボックスリスト | 選択されたアーティストのアルバム一覧をジャケット画像と共に表示する。各アルバムにチェックボックスを設け、出題対象を選択可能にする。 |
| 5 | 一括選択ボタン | ボタン | 「すべて選択」「すべて解除」の2つのボタンを配置し、表示されているアルバムを一括で選択/解除できる。 |
| 6 | クイズ開始ボタン | ボタン | 「クイズ開始」ボタン。1つ以上のアルバムが選択されている場合に活性化する。クリックすると、選択されたアルバムをクエリパラメータとしてクイズ画面に遷移する。 |
**4.2.2. クイズ画面 (** /quiz **)**
クイズをプレイするメイン画面です。
**UIコンポーネントと仕様:**
| **No.** | **UI要素** | **種別** | **説明** |
|:-:|:-:|:-:|:-:|
| 1 | 問題番号 | テキスト | 「Q. 1」「Q. 2」のように現在の問題番号を表示する。 |
| 2 | YouTube埋め込み | iframe | 楽曲再生用のYouTube iframe。**ユーザーには見えないように** 1px × 1px **のサイズで画面外に配置**し、音声のみを再生する。 |
| 3 | 再生ボタン | ボタン | アイコン（▶/❚❚）で再生/停止状態を示す。クリックで楽曲の中盤を指定時間再生/停止する。 |
| 4 | 再生時間選択 | プルダウン | 再生時間を「1秒」「3秒」「5秒」「10秒」「15秒」から選択できる。デフォルトは「5秒」。 |
| 5 | 答えを表示ボタン | ボタン | クリックすると、解答エリア(No.6)を表示する。一度クリックすると非活性化する。 |
| 6 | 解答エリア | コンテナ | **初期状態では非表示。**「答えを表示」ボタンクリックで表示される。以下の要素を含む。<br>・アルバムジャケット画像 (jacketUrl)<br>・曲名 (title)<br>・アーティスト名 (name) |
| 7 | 次へボタン | ボタン | **初期状態では非活性。**「答えを表示」ボタンクリック後に活性化する。クリックすると次の問題へ進む。 |
| 8 | 出題範囲設定ボタン | ボタン | 歯車アイコンなどのボタン。クリックすると出題範囲設定モーダル(No.9)を開く。 |
| 9 | 出題範囲設定モーダル | モーダル | トップ画面と同様のアルバム選択機能を提供するモーダルウィンドウ。ここでの変更は「設定を閉じる」をクリックした後の、次の問題から反映される。 |
### 4.3. 共通機能要件
**4.3.1. 楽曲再生ロジック**
* **再生箇所の決定:**
  * **原則 (Default Rule):** songs.jsonの楽曲データにdurationの指定がない場合、多くの楽曲が平均4〜5分であることを想定し、**90秒から150秒の間**のランダムな整数秒を開始位置とします。
  * **例外 (Exception Rule):** 楽曲データにduration (曲の総再生時間) が指定されている場合、その曲の中盤部分を再生します。具体的な開始時間は、duration * 0.4 から duration * 0.6 の間のランダムな整数秒とします。この仕組みにより、極端に再生時間が短い、または長い楽曲にも柔軟に対応できます。
  * **優先事項 (Priority):** 楽曲データにmidpointStartが指定されている場合は、上記の計算ロジックよりも優先してその値を再生開始時間として使用します。
* **YouTube再生制御:**
  * YouTube IFrame Player API を利用して、再生、停止、シークを制御する。
  * loadVideoById メソッドに startSeconds パラメータを指定して、決定された開始時間から再生を開始する。
  * setTimeout を使用して、指定秒数後に pauseVideo を呼び出し、再生を停止する。

⠀5. 非機能要件
| **項目** | **要件** |
|:-:|:-:|
| **ユーザビリティ (UI/UX)** | ・専門知識がなくても直感的に操作できる、シンプルで分かりやすい画面デザイン。<br>・スマートフォン、タブレット、PCなど、異なる画面サイズでも表示が崩れず、快適に操作できるレスポンシブデザインを採用する。 |
| **パフォーマンス** | ・画面遷移や楽曲データの読み込みが高速であり、ユーザーにストレスを与えないこと。<br>・特にクイズ画面での次問題への切り替えは1秒以内に完了することを目指す。 |
| **セキュリティ** | ・YouTube APIキーを使用する場合、クライアントサイドに直接埋め込まず、サーバーサイド（Next.js API Routes）経由でリクエストをプロキシするなど、キーが漏洩しないように対策を講じる。（※本要件ではIFrame Player APIのみを想定しているため、APIキーは不要の見込み） |
| **運用・保守** | ・songs.json の更新（楽曲の追加・修正）が容易に行える構造であること。<br>・コードはリーダブルであり、他の開発者が容易にメンテナンスできること。 |
# 6. 用語集
| **用語** | **説明** |
|:-:|:-:|
| 中トロドン | 本アプリケーションの名称。楽曲の中盤を聴いて曲名を当てるクイズ形式。 |
| 出題範囲 | クイズに出題される楽曲の集合。ユーザーがアルバム単位で選択する。 |
| セッション | ユーザーがトップ画面で「クイズ開始」をクリックしてから、全問終了するか離脱するまでの一連のプレイ。 |
